@model CarRentingSystem2025.Models.Rental
@{
    ViewData["Title"] = "Rental Details";
    Layout = "_AdminLayout";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-car"></i> Rental Details</h2>
        <div>
            <a asp-area="Admin" asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">
                <i class="fas fa-edit"></i> Edit
            </a>
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Rental Information -->
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> Rental Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <dl class="row">
                                <dt class="col-sm-4">Rental ID:</dt>
                                <dd class="col-sm-8">@Model.Id</dd>

                                <dt class="col-sm-4">Status:</dt>
                                <dd class="col-sm-8">
                                    <span class="badge @(Model.Status switch {
                                        "Active" => "bg-success",
                                        "Completed" => "bg-info",
                                        "Cancelled" => "bg-warning",
                                        "Overdue" => "bg-danger",
                                        _ => "bg-secondary"
                                    })">@Model.Status</span>
                                </dd>

                                <dt class="col-sm-4">Pickup Date:</dt>
                                <dd class="col-sm-8">@Model.PickupDate.ToString("MMM dd, yyyy")</dd>

                                <dt class="col-sm-4">Dropoff Date:</dt>
                                <dd class="col-sm-8">@Model.DropoffDate.ToString("MMM dd, yyyy")</dd>

                                <dt class="col-sm-4">Total Amount:</dt>
                                <dd class="col-sm-8"><strong>€@Model.TotalAmount.ToString("N2")</strong></dd>

                                <dt class="col-sm-4">Pickup Location:</dt>
                                <dd class="col-sm-8">@Model.PickupLocation</dd>

                                <dt class="col-sm-4">Dropoff Location:</dt>
                                <dd class="col-sm-8">@Model.DropoffLocation</dd>
                            </dl>
                        </div>
                        <div class="col-md-6">
                            <dl class="row">
                                <dt class="col-sm-4">Deposit Amount:</dt>
                                <dd class="col-sm-8">€@(Model.DepositAmount?.ToString("N2") ?? "0.00")</dd>

                                <dt class="col-sm-4">Insurance Type:</dt>
                                <dd class="col-sm-8">@Model.InsuranceType</dd>

                                <dt class="col-sm-4">Insurance Cost:</dt>
                                <dd class="col-sm-8">€@(Model.InsuranceCost?.ToString("N2") ?? "0.00")</dd>

                                <dt class="col-sm-4">Late Fees:</dt>
                                <dd class="col-sm-8">€@(Model.LateFees?.ToString("N2") ?? "0.00")</dd>

                                <dt class="col-sm-4">Damage Fees:</dt>
                                <dd class="col-sm-8">€@(Model.DamageFees?.ToString("N2") ?? "0.00")</dd>

                                <dt class="col-sm-4">Created:</dt>
                                <dd class="col-sm-8">@Model.CreatedAt.ToString("MMM dd, yyyy HH:mm")</dd>

                                @if (Model.UpdatedAt.HasValue)
                                {
                                    <dt class="col-sm-4">Last Updated:</dt>
                                    <dd class="col-sm-8">@Model.UpdatedAt.Value.ToString("MMM dd, yyyy HH:mm")</dd>
                                }
                            </dl>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.SpecialRequests))
                    {
                        <div class="mt-3">
                            <h6>Special Requests:</h6>
                            <p class="text-muted">@Model.SpecialRequests</p>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.DamageDescription))
                    {
                        <div class="mt-3">
                            <h6>Damage Description:</h6>
                            <p class="text-danger">@Model.DamageDescription</p>
                        </div>
                    }

                    @if (Model.CustomerRating.HasValue)
                    {
                        <div class="mt-3">
                            <h6>Customer Rating:</h6>
                            <div class="d-flex align-items-center">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="fas fa-star @(i <= Model.CustomerRating ? "text-warning" : "text-muted")"></i>
                                }
                                <span class="ms-2">(@Model.CustomerRating/5)</span>
                            </div>
                            @if (!string.IsNullOrEmpty(Model.CustomerReview))
                            {
                                <p class="text-muted mt-2">@Model.CustomerReview</p>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Car Information -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-car"></i> Car Information</h5>
                </div>
                <div class="card-body">
                    <h6>@Model.Car?.BrandEntity?.Name @Model.Car?.Model</h6>
                    <p class="text-muted">@Model.Car?.Year - @Model.Car?.LicensePlate</p>
                    
                    <dl class="row">
                        <dt class="col-sm-4">Brand:</dt>
                        <dd class="col-sm-8">@Model.Car?.BrandEntity?.Name</dd>

                        <dt class="col-sm-4">Model:</dt>
                        <dd class="col-sm-8">@Model.Car?.Model</dd>

                        <dt class="col-sm-4">Year:</dt>
                        <dd class="col-sm-8">@Model.Car?.Year</dd>

                        <dt class="col-sm-4">License Plate:</dt>
                        <dd class="col-sm-8">@Model.Car?.LicensePlate</dd>

                        <dt class="col-sm-4">Color:</dt>
                        <dd class="col-sm-8">@Model.Car?.Color</dd>

                        <dt class="col-sm-4">Daily Rate:</dt>
                        <dd class="col-sm-8">€@(Model.Car?.DailyRate.ToString("N2") ?? "0.00")</dd>

                        <dt class="col-sm-4">Status:</dt>
                        <dd class="col-sm-8">
                            <span class="badge @(Model.Car?.IsAvailable == true ? "bg-success" : "bg-danger")">
                                @(Model.Car?.IsAvailable == true ? "Available" : "Rented")
                            </span>
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- Customer Information -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user"></i> Customer Information</h5>
                </div>
                <div class="card-body">
                    <h6>@Model.Customer?.FirstName @Model.Customer?.LastName</h6>
                    <p class="text-muted">@Model.Customer?.Email</p>
                    
                    <dl class="row">
                        <dt class="col-sm-4">Phone:</dt>
                        <dd class="col-sm-8">@Model.Customer?.PhoneNumber</dd>

                        <dt class="col-sm-4">License:</dt>
                        <dd class="col-sm-8">@Model.Customer?.DriverLicenseNumber</dd>

                        <dt class="col-sm-4">Address:</dt>
                        <dd class="col-sm-8">
                            @Model.Customer?.Address<br>
                            @Model.Customer?.City, @Model.Customer?.PostalCode<br>
                            @Model.Customer?.Country
                        </dd>

                        <dt class="col-sm-4">Member Since:</dt>
                        <dd class="col-sm-8">@(Model.Customer?.CreatedAt.ToString("MMM yyyy") ?? "N/A")</dd>

                        <dt class="col-sm-4">Total Rentals:</dt>
                        <dd class="col-sm-8">@Model.Customer?.TotalRentals</dd>

                        <dt class="col-sm-4">Total Spent:</dt>
                        <dd class="col-sm-8">€@(Model.Customer?.TotalSpent.ToString("N2") ?? "0.00")</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Update Form -->
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-edit"></i> Update Status</h5>
        </div>
        <div class="card-body">
            <form asp-action="UpdateStatus" method="post" class="row g-3">
                <input type="hidden" name="id" value="@Model.Id" />
                <div class="col-md-4">
                    <label for="newStatus" class="form-label">New Status</label>
                    <select class="form-select" id="newStatus" name="newStatus" required>
                        <option value="">Select Status</option>
                        <option value="Active" @(Model.Status == "Active" ? "selected" : "")>Active</option>
                        <option value="Completed" @(Model.Status == "Completed" ? "selected" : "")>Completed</option>
                        <option value="Cancelled" @(Model.Status == "Cancelled" ? "selected" : "")>Cancelled</option>
                        <option value="Overdue" @(Model.Status == "Overdue" ? "selected" : "")>Overdue</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-primary d-block w-100">
                        <i class="fas fa-save"></i> Update Status
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
